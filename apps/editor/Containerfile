FROM python:3.12-slim

WORKDIR /app

RUN pip install --no-cache-dir poetry

COPY apps/editor/pyproject.toml apps/editor/poetry.lock* ./

RUN poetry config virtualenvs.create false && \
    poetry install --no-interaction --no-ansi --no-root --only main

COPY schema/              /app/schema/
COPY templates            /app/templates/
COPY data/*.clusterfile   /app/samples/
COPY apps/editor/static/  /app/static/
COPY apps/editor/app/     /app/app/
COPY apps/editor/entrypoint.sh /app/entrypoint.sh

RUN chmod +x /app/entrypoint.sh

EXPOSE 8000

CMD ["/app/entrypoint.sh"]
